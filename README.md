# KKBox Churn Prediction Pipeline

æœ¬é¡¹ç›®åŸºäº Kaggle çš„ [WSDM - KKBox's Churn Prediction Challenge](https://www.kaggle.com/competitions/kkbox-churn-prediction-challenge) æ„å»ºï¼Œç›®æ ‡æ˜¯é¢„æµ‹ç”¨æˆ·åœ¨ä¼šå‘˜åˆ°æœŸå 30 å¤©å†…æ˜¯å¦ä¼šç»­è®¢æœåŠ¡ã€‚é¡¹ç›®å®ç°äº†ä»æ•°æ®åŠ è½½ã€ç‰¹å¾å·¥ç¨‹ã€æ¨¡å‹è®­ç»ƒã€è°ƒå‚ã€èåˆåˆ°æäº¤æ–‡ä»¶ç”Ÿæˆçš„å…¨æµç¨‹è‡ªåŠ¨åŒ–å»ºæ¨¡ç³»ç»Ÿã€‚

---

## ğŸ“ é¡¹ç›®ç»“æ„
kkbox-churn-prediction/
â”œâ”€â”€ data/
â”‚   â””â”€â”€ raw/                      # åŸå§‹æ•°æ®ï¼ˆå¦‚ train_v2.csv, user_logs_v2.csv ç­‰ï¼‰
â”œâ”€â”€ outputs/
â”‚   â”œâ”€â”€ models/                  # ä¿å­˜è®­ç»ƒå¥½çš„æ¨¡å‹
â”‚   â”œâ”€â”€ preds/                   # ä¿å­˜æµ‹è¯•é›†é¢„æµ‹ç»“æœ
â”‚   â”œâ”€â”€ val_preds/               # ä¿å­˜éªŒè¯é›†é¢„æµ‹ç»“æœ
â”‚   â”œâ”€â”€ submissions/             # æœ€ç»ˆæäº¤æ–‡ä»¶
â”‚   â””â”€â”€ val_labels.csv           # éªŒè¯é›†çœŸå®æ ‡ç­¾
â”œâ”€â”€ params/                      # æ¯ä¸ªæ¨¡å‹çš„æœ€ä½³å‚æ•° JSON æ–‡ä»¶
â”œâ”€â”€ ensemble_weights.yaml        # èåˆæƒé‡é…ç½®ï¼ˆå¯æ‰‹åŠ¨æˆ–è‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ data_loader.py
â”‚   â”œâ”€â”€ feature_engineering.py
â”‚   â”œâ”€â”€ model.py
â”‚   â”œâ”€â”€ pipeline.py
â”‚   â”œâ”€â”€ predict.py
â”‚   â”œâ”€â”€ tune_model.py
â”‚   â”œâ”€â”€ auto_pipeline.py
â”‚   â””â”€â”€ optimize_ensemble.py
---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å‡†å¤‡æ•°æ®

å°†ä»¥ä¸‹æ–‡ä»¶è§£å‹å¹¶æ”¾å…¥ `data/raw/` ç›®å½•ï¼š

- `train_v2.csv`
- `transactions_v2.csv`
- `user_logs_v2.csv`
- `members_v3.csv`
- `sample_submission_v2.csv`

### 2. å¯é€‰ï¼šè°ƒå‚ï¼ˆé¦–æ¬¡æˆ–å‚æ•°æ›´æ–°æ—¶ï¼‰

```bash
python -m src.tune_model --model_type lightgbm --n_trials 30 --sample False
python -m src.tune_model --model_type xgboost --n_trials 30 --sample False
python -m src.tune_model --model_type catboost --n_trials 30 --sample False

è°ƒå‚ç»“æœå°†ä¿å­˜è‡³ â€â params/{model_type}_best_params.jsonâ ã€‚

3. ä¸»æµç¨‹ï¼šè‡ªåŠ¨è®­ç»ƒ + é¢„æµ‹ + èåˆ + æäº¤æ–‡ä»¶ç”Ÿæˆpython -m src.auto_pipeline

è¯¥å‘½ä»¤å°†ï¼š
	â€¢	è‡ªåŠ¨è°ƒå‚ï¼ˆå¦‚æœªè°ƒè¿‡ï¼‰ï¼›
	â€¢	ä½¿ç”¨æœ€ä½³å‚æ•°è®­ç»ƒæ¨¡å‹ï¼›
	â€¢	ä¿å­˜éªŒè¯é›†é¢„æµ‹ç»“æœå’Œæ ‡ç­¾ï¼›
	â€¢	å¯¹æµ‹è¯•é›†è¿›è¡Œé¢„æµ‹ï¼›
	â€¢	ä» â€â ensemble_weights.yamlâ  è¯»å–èåˆæƒé‡ï¼ˆå¦‚æ— åˆ™ä½¿ç”¨ç­‰æƒé‡ï¼‰ï¼›
	â€¢	ç”Ÿæˆæäº¤æ–‡ä»¶è‡³ â€â outputs/submissions/â ã€‚

4. å¯é€‰ï¼šä¼˜åŒ–èåˆæƒé‡ï¼ˆåŸºäºéªŒè¯é›†ï¼‰

å¦‚æœä½ å¸Œæœ›æ ¹æ®éªŒè¯é›†è¡¨ç°è‡ªåŠ¨ä¼˜åŒ– LightGBMã€XGBoost å’Œ CatBoost çš„èåˆæƒé‡ï¼Œå¯ä»¥æ‰§è¡Œï¼špython -m src.optimize_ensemble

è¯¥å‘½ä»¤ä¼šï¼š
	â€¢	åŠ è½½æ¯ä¸ªæ¨¡å‹åœ¨éªŒè¯é›†ä¸Šçš„é¢„æµ‹ç»“æœï¼ˆä½äº â€â outputs/val_preds/â ï¼‰ï¼›
	â€¢	åŠ è½½éªŒè¯é›†çœŸå®æ ‡ç­¾ï¼ˆä½äº â€â outputs/val_labels.csvâ ï¼‰ï¼›
	â€¢	ä½¿ç”¨ Optuna æœç´¢æœ€ä¼˜èåˆæƒé‡ï¼ˆä»¥ log loss æœ€å°ä¸ºç›®æ ‡ï¼‰ï¼›
	â€¢	è¾“å‡ºæœ€ä¼˜æƒé‡ç»„åˆï¼Œå¹¶ä¿å­˜ä¸º â€â ensemble_weights_optimized.yamlâ ã€‚

æ³¨æ„ï¼šè¯¥æ–‡ä»¶ä¸ä¼šè‡ªåŠ¨æ›¿æ¢ä¸»æµç¨‹ä½¿ç”¨çš„ â€â ensemble_weights.yamlâ ã€‚

å¦‚æœä½ å¸Œæœ›åœ¨ä¸‹ä¸€æ¬¡è¿è¡Œ â€â auto_pipeline.pyâ  æ—¶ä½¿ç”¨ä¼˜åŒ–åçš„æƒé‡ï¼Œè¯·æ‰‹åŠ¨æ‰§è¡Œï¼šmv ensemble_weights_optimized.yaml ensemble_weights.yaml

ç„¶åé‡æ–°è¿è¡Œèåˆä¸æäº¤æµç¨‹ï¼ˆä¸éœ€è¦é‡æ–°è®­ç»ƒæ¨¡å‹ï¼‰ï¼špython -m src.auto_pipeline

ğŸ“Œ æ¨¡å‹æ”¯æŒ
	â€¢	LightGBM
	â€¢	XGBoost
	â€¢	CatBoost

æ¯ä¸ªæ¨¡å‹å‡æ”¯æŒï¼š
	â€¢	è‡ªåŠ¨è°ƒå‚ï¼ˆOptunaï¼‰
	â€¢	åˆ†ç±»ç‰¹å¾å¤„ç†
	â€¢	éªŒè¯é›†è¯„ä¼°ä¸ early stopping
	â€¢	æ¨¡å‹ä¿å­˜ä¸åŠ è½½

ğŸ“ˆ ç‰¹å¾å·¥ç¨‹äº®ç‚¹
	â€¢	ç”¨æˆ·ç”»åƒç‰¹å¾ï¼ˆåŸå¸‚ã€æ€§åˆ«ã€æ³¨å†Œæ–¹å¼ã€å¹´é¾„ç­‰ï¼‰
	â€¢	äº¤æ˜“è¡Œä¸ºç‰¹å¾ï¼ˆæ˜¯å¦è‡ªåŠ¨ç»­è®¢ã€ä»˜æ¬¾é‡‘é¢ã€è®¢é˜…å‘¨æœŸç­‰ï¼‰
	â€¢	æ—¶é—´å·®ç‰¹å¾ï¼ˆæ³¨å†Œåˆ°é¦–æ¬¡è®¢é˜…ã€ä¸Šæ¬¡åˆ°æœŸåˆ°æœ¬æ¬¡äº¤æ˜“é—´éš”ç­‰ï¼‰
	â€¢	ç”¨æˆ·æ´»è·ƒåº¦ç‰¹å¾ï¼ˆå¬æ­Œæ—¶é•¿ã€å®Œæ•´æ’­æ”¾æ¯”ä¾‹ã€æ´»è·ƒå¤©æ•°ç­‰ï¼‰
	â€¢	æ»šåŠ¨çª—å£ç‰¹å¾ï¼ˆæœ€è¿‘ 7 å¤©ã€30 å¤©è¡Œä¸ºï¼‰
	â€¢	è¡Œä¸ºè¶‹åŠ¿ç‰¹å¾ï¼ˆæ´»è·ƒåº¦å˜åŒ–ç‡ã€æ˜¯å¦å˜æ‡’ï¼‰
	â€¢	äº¤å‰ç‰¹å¾ä¸ç¼ºå¤±å€¼æ ‡è®°

ğŸ“„ æäº¤æ–‡ä»¶æ ¼å¼

æœ€ç»ˆæäº¤æ–‡ä»¶ä½äº â€â outputs/submissions/â ï¼Œæ ¼å¼å¦‚ä¸‹ï¼šmsno,is_churn
user_0001,0.0234
user_0002,0.9812
...

ğŸ“š ä¾èµ–ç¯å¢ƒ
	â€¢	Python 3.8+
	â€¢	pandas, numpy, scikit-learn
	â€¢	lightgbm, xgboost, catboost
	â€¢	optuna
	â€¢	pyyaml
	â€¢	joblib

å»ºè®®ä½¿ç”¨ conda æˆ– virtualenv åˆ›å»ºç‹¬ç«‹ç¯å¢ƒã€‚

ğŸ§  åç»­å¯æ‰©å±•æ–¹å‘
	â€¢	å¤šæ¨¡å‹ stacking èåˆ
	â€¢	æ—¶é—´åºåˆ—å»ºæ¨¡ï¼ˆå¦‚ LSTMï¼‰
	â€¢	ç”¨æˆ·åˆ†ç¾¤å»ºæ¨¡ï¼ˆsegmentation + per-group modelï¼‰
	â€¢	è‡ªåŠ¨æäº¤åˆ° Kaggleï¼ˆä½¿ç”¨ kaggle APIï¼‰
	â€¢	å°è£…ä¸º CLI å·¥å…·æˆ–ä¸€é”® â€â .shâ  è„šæœ¬

ğŸ™Œ è‡´è°¢

æœ¬é¡¹ç›®åŸºäº KKBox æä¾›çš„çœŸå®ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œæ„Ÿè°¢ WSDM Cup å’Œ Kaggle ç¤¾åŒºçš„æ”¯æŒä¸å¯å‘ã€‚